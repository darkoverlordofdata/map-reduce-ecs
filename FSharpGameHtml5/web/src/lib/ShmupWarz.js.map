{"version":3,"sources":["..\\..\\..\\lib\\ShmupWarz.fs"],"names":[],"mappings":"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","file":"ShmupWarz.js","sourcesContent":["ï»¿module ShmupWarz\r\n\r\n(** ShmupWarz Game Demo *)\r\n#if FABLE\r\nopen Fable.Core\r\nopen Fable.Import\r\nopen Fable.Import.Browser\r\nopen Fable.Core.JsInterop\r\n#endif\r\nopen Bosco\r\nopen Components\r\nopen Entities\r\nopen SystemInterface\r\nopen Systems\r\nopen System.Collections.Generic\r\n\r\n(**\r\n * Create the Entity DataBase\r\n *) \r\nlet CreateEntityDB(content) = \r\n    [\r\n        CreatePlayer(content);\r\n        CreateBang(content);\r\n        CreateBang(content);\r\n        CreateBang(content);\r\n        CreateBang(content);\r\n        CreateBang(content);\r\n        CreateBang(content);\r\n        CreateBang(content);\r\n        CreateBang(content);\r\n        CreateExplosion(content);\r\n        CreateExplosion(content);\r\n        CreateExplosion(content);\r\n        CreateExplosion(content);\r\n        CreateExplosion(content);\r\n        CreateExplosion(content);\r\n        CreateExplosion(content);\r\n        CreateExplosion(content);\r\n        CreateBullet(content);\r\n        CreateBullet(content);\r\n        CreateBullet(content);\r\n        CreateBullet(content);\r\n        CreateBullet(content);\r\n        CreateBullet(content);\r\n        CreateBullet(content);\r\n        CreateBullet(content);\r\n        CreateBullet(content);\r\n        CreateBullet(content);\r\n        CreateBullet(content);\r\n        CreateBullet(content);\r\n        CreateBullet(content);\r\n        CreateBullet(content);\r\n        CreateBullet(content);\r\n        CreateBullet(content);\r\n        CreateBullet(content);\r\n        CreateBullet(content);\r\n        CreateBullet(content);\r\n        CreateBullet(content);\r\n        CreateBullet(content);\r\n        CreateBullet(content);\r\n        CreateBullet(content);\r\n        CreateEnemy1(content);\r\n        CreateEnemy1(content);\r\n        CreateEnemy1(content);\r\n        CreateEnemy1(content);\r\n        CreateEnemy1(content);\r\n        CreateEnemy1(content);\r\n        CreateEnemy1(content);\r\n        CreateEnemy1(content);\r\n        CreateEnemy1(content);\r\n        CreateEnemy2(content);\r\n        CreateEnemy2(content);\r\n        CreateEnemy2(content);\r\n        CreateEnemy2(content);\r\n        CreateEnemy2(content);\r\n        CreateEnemy2(content);\r\n        CreateEnemy3(content);\r\n        CreateEnemy3(content);\r\n        CreateEnemy3(content);\r\n        CreateEnemy3(content);\r\n\r\n    ]\r\n\r\nlet ASSETS = \r\n    dict[\r\n        \"background\", \"images/BackdropBlackLittleSparkBlack.png\";\r\n        \"bang\", \"images/bang.png\";\r\n        \"bullet\", \"images/bullet.png\";\r\n        \"enemy1\",\"images/enemy1.png\";\r\n        \"enemy2\",\"images/enemy2.png\";\r\n        \"enemy3\",\"images/enemy3.png\";\r\n        \"explosion\",\"images/explosion.png\";\r\n        \"fighter\",\"images/fighter.png\";\r\n        \"font\",\"images/tom-thumb-white.png\"\r\n        ]\r\n\r\n(** ShmupWarz *)\r\ntype ShmupWarz(height, width0, mobile) as this =\r\n    inherit SystemInterface(height, width0, Dictionary<string, string>ASSETS)\r\n    let pixelFactor = (if mobile then 2.0 else 1.0)\r\n    let width = ((float)width0/pixelFactor)\r\n    let mutable entities = lazy(CreateEntityDB(this.Content))\r\n    let fntImage = lazy(PIXI.Sprite(unbox this.Content?font?texture))\r\n    let bgdImage = lazy(PIXI.Sprite(unbox this.Content?background?texture))\r\n    let bgdRect = PIXI.Rectangle(0., 0., width, height)\r\n    let scaleX = (float) (width / 320.) // pixelFactor\r\n    let scaleY = (float) (height / 480.) // pixelFactor\r\n\r\n    let activeEntities (input:Entity list) =\r\n        let rec _activeEntities (input:Entity list) (output:Entity list) =\r\n            match input with\r\n            | x::xs when x.Active -> _activeEntities xs (x::output)\r\n            | _::xs -> _activeEntities xs output \r\n            | [] -> output\r\n        _activeEntities input []\r\n    (** Draw the sprite for an Entity *)\r\n    let drawSprite(spriteBatch:PIXI.Container) (entity) =\r\n        match entity.Sprite with\r\n        | Some sprite ->\r\n            let scale =\r\n                match entity.Scale with\r\n                | Some(scale) -> scale\r\n                | None -> PIXI.Point(1., 1.)\r\n            let color = \r\n                match entity.Tint with \r\n                | Some(color) -> color\r\n                | None -> Color.White\r\n            sprite.x <- entity.Position.x\r\n            sprite.y <- entity.Position.y\r\n            sprite.scale <- scale\r\n            sprite.tint <- float color\r\n            spriteBatch.addChild(sprite) |> ignore\r\n\r\n        | None -> ()\r\n\r\n    member this.Initialize() =\r\n        Keyboard.init()\r\n        Mouse.init()\r\n        base.Initialize()\r\n\r\n    override this.LoadContent() =\r\n        entities.Force() |> ignore\r\n        ()\r\n\r\n    override this.Draw(gameTime) =        \r\n        this.spriteBatch.children?length <- 0\r\n        this.spriteBatch.addChild(bgdImage.Value) |> ignore\r\n        activeEntities(entities.Value)\r\n        |> List.sortBy(fun e -> e.Layer) \r\n        |> List.iter(drawSprite(this.spriteBatch))\r\n        ()\r\n\r\n    override this.Update(gameTime) =\r\n        //  if GamePad.GetState(PlayerIndex.One).Buttons.Back = ButtonState.Pressed then \r\n        //     this.Exit()\r\n        let delta = gameTime\r\n        let current = entities.Value\r\n\r\n        EnemySpawningSystem(delta, this) |> ignore\r\n        entities <-  // Everything happens here:\r\n            lazy (current\r\n                 |> List.map(InputSystem(delta, mobile, this))\r\n                 |> List.map(EntitySystem(this, int width, int height))\r\n                 |> List.map(MovementSystem(delta))\r\n                 |> List.map(ExpiringSystem(delta))\r\n                 |> List.map(TweenSystem(delta, this))\r\n                 |> List.map(RemoveOffscreenShipsSystem(this, int width, int height))\r\n                 |> CollisionSystem(this)\r\n                 )\r\n\r\n        // pick up the list when we draw\r\n        //this.entityList <- ActiveEntities (entities.Force())\r\n       \r\n    (** Deactivate an Entity *)\r\n    override this.RemoveEntity(id:int) =\r\n        this.Deactivate <- id :: this.Deactivate\r\n\r\n    (** Que a Bullet *)\r\n    override this.AddBullet(x: float, y:float) =\r\n        this.Bullets <- BulletQue(x, y) :: this.Bullets\r\n        //Browser.console.log(\"AddBullet\", x, y, this.Bullets.Length)\r\n\r\n    (** Que a Enemy *)\r\n    override this.AddEnemy(enemy : Enemies) =\r\n        match enemy with \r\n        | Enemies.Enemy1 -> this.Enemies1 <- EnemyQue(enemy) :: this.Enemies1\r\n        | Enemies.Enemy2 -> this.Enemies2 <- EnemyQue(enemy) :: this.Enemies2\r\n        | Enemies.Enemy3 -> this.Enemies3 <- EnemyQue(enemy) :: this.Enemies3\r\n        | _ -> ()\r\n\r\n    (** Que an Explosion *)\r\n    override this.AddExplosion(x: float, y:float, scale : float) =\r\n        this.Explosions <- ExplosionQue(x, y, scale) :: this.Explosions\r\n\r\n    (** Que a Bang *)\r\n    override this.AddBang(x: float, y:float, scale : float) =\r\n        this.Bangs <- ExplosionQue(x, y, scale) :: this.Bangs\r\n\r\n\r\nlet game = ShmupWarz(320.*1.5, 480.*1.5, false)\r\ngame.Run() |> ignore\r\n\r\n\r\n"]}